package day_test

import (
	"fmt"
	"sort"
	"strings"
	"testing"
)

type cart struct {
	nextTurn    Direction
	orientation Orientation
	coord       coord
}

func (c *cart) Update(ft FullTrack) {
	// go further
	c.coord = c.coord.Next(c.orientation)

	// adjust orientation
	switch ft[c.coord] {
	case ES: // /
		if c.orientation == Left || c.orientation == Right {
			c.orientation = c.orientation.Turn(GoLeft)
		} else if c.orientation == Up || c.orientation == Down {
			c.orientation = c.orientation.Turn(GoRight)
		} else {
			panic("unexpected orientation " + string(c.orientation))
		}
	case SW: // \
		if c.orientation == Left || c.orientation == Right {
			c.orientation = c.orientation.Turn(GoRight)
		} else if c.orientation == Up || c.orientation == Down {
			c.orientation = c.orientation.Turn(GoLeft)
		} else {
			panic("unexpected orientation " + string(c.orientation))
		}
	case Cross:
		c.orientation = c.orientation.Turn(c.nextTurn)
		if c.nextTurn == GoStraight {
			c.nextTurn = GoRight
		} else if c.nextTurn == GoLeft {
			c.nextTurn = GoStraight
		} else if c.nextTurn == GoRight {
			c.nextTurn = GoLeft
		}
	// do nothing :
	case EW:
	case NS:
	}

}

type cartList []*cart

var _ sort.Interface = cartList{}

func (cl cartList) Len() int { return len(cl) }
func (cl cartList) Less(i, j int) bool {
	if cl[i].coord.y < cl[j].coord.y {
		return true
	}
	if cl[i].coord.y == cl[j].coord.y && cl[i].coord.x < cl[j].coord.x {
		return true
	}
	return false
}

func (cl cartList) Swap(i, j int) { cl[i], cl[j] = cl[j], cl[i] }

func (c cart) String() string {
	return fmt.Sprintf("%s %v", string(c.orientation), c.coord)
}

func (cl cartList) String() string {
	lines := make([][]byte, cl[len(cl)-1].coord.y+1)
	for i := len(cl) - 1; i >= 0; i-- {
		c := cl[i].coord
		if lines[c.y] == nil {
			lines[c.y] = make([]byte, c.x+1)
			for j := 0; j < c.x; j++ {
				lines[c.y][j] = ' '
			}
		}
		lines[c.y][c.x] = byte(cl[i].orientation)
	}
	var slines []string
	for _, l := range lines {
		slines = append(slines, string(l))
	}
	return strings.Join(slines, "\n")
}

func parseCart(c rune) *cart {
	switch c {
	case '>':
		return &cart{orientation: Right}
	case 'v':
		return &cart{orientation: Down}
	case '<':
		return &cart{orientation: Left}
	case '^':
		return &cart{orientation: Up}
	}
	return nil
}

func parseCarts(in string) cartList {
	var carts cartList
	for y, line := range strings.Split(in, "\n") {
		if y == 34 {
			fmt.Println(line)
		}
		for x, c := range line {
			if cart := parseCart(c); cart != nil {
				cart.coord = coord{x, y}
				cart.nextTurn = GoLeft
				carts = append(carts, cart)
			}
		}
	}
	return carts
}

type Direction int

const (
	GoLeft Direction = iota
	GoStraight
	GoRight
)

type Orientation byte

const (
	Up    Orientation = '^'
	Down  Orientation = 'v'
	Left  Orientation = '<'
	Right Orientation = '>'
)

func (o Orientation) Turn(d Direction) Orientation {
	if d == GoStraight {
		return o
	}
	if d == GoLeft {
		switch o {
		case Up:
			return Left
		case Down:
			return Right
		case Left:
			return Down
		case Right:
			return Up
		}
	}
	if d == GoRight {
		switch o {
		case Up:
			return Right
		case Down:
			return Left
		case Left:
			return Up
		case Right:
			return Down
		}
	}
	panic("unsupported direction " + string(o))
}

type TrackType byte

const (
	EW    TrackType = '-'
	NS    TrackType = '|'
	ES    TrackType = '/'
	SW    TrackType = '\\'
	Cross TrackType = '+'
)

func (tt TrackType) String() string {
	return string(tt)
}

func parseTrackType(c rune) TrackType {
	switch c {
	case '>':
		fallthrough
	case '<':
		fallthrough
	case '-':
		return EW
	case 'v':
		fallthrough
	case '^':
		fallthrough
	case '|':
		return NS
	case '/':
		return ES
	case '\\':
		return SW
	case '+':
		return Cross
	}
	panic("unsupported track type: '" + string(c) + "'")
}

type FullTrack map[coord]TrackType

type coord struct {
	x, y int
}

func (c coord) Next(o Orientation) coord {
	switch o {
	case Left:
		return coord{c.x - 1, c.y}
	case Right:
		return coord{c.x + 1, c.y}
	case Up:
		return coord{c.x, c.y - 1}
	case Down:
		return coord{c.x, c.y + 1}
	}
	panic("unknown orientation " + string(o))
}

func parseTrack(in string) FullTrack {
	track := make(FullTrack)
	for y, line := range strings.Split(in, "\n") {
		for x, c := range line {
			if c == ' ' {
				continue
			}
			track[coord{x, y}] = parseTrackType(c)
		}
	}
	return track
}

func parseAll(input string) (FullTrack, cartList) {
	return parseTrack(input), parseCarts(input)
}

var inputTest = `/->-\
|   |  /----\
| /-+--+-\  |
| | |  | v  |
\-+-/  \-+--/
  \------/`

var inputTest2 = `/>-<\
|   |
| /<+-\
| | | v
\>+</ |
  |   ^
  \<->/`

func TestOne(t *testing.T) {
	ft, carts := parseAll(input)
	// fmt.Println(ft)

	busy := make(map[coord]bool)
	for _, c := range carts {
		busy[c.coord] = true
	}

	for _, c := range carts {
		fmt.Println(c)
	}
	for {
		sort.Sort(carts)
		// fmt.Println(carts)
		// fmt.Println("---")
		crashes := make([]coord, 0)
		for _, c := range carts {
			crashed := false
			for _, cr := range crashes {
				if c.coord == cr {
					crashed = true
					break
				}
			}
			if crashed {
				continue
			}
			delete(busy, c.coord)
			c.Update(ft)
			if busy[c.coord] {
				t.Logf("crash %v", c.coord)
				crashes = append(crashes, c.coord)
			}
			busy[c.coord] = true
		}

		if len(crashes) == 0 {
			continue
		}

		remainingCarts := make(cartList, 0, len(carts))
		for _, c := range carts {
			crashed := false
			for _, crash := range crashes {
				delete(busy, crash)
				if c.coord == crash {
					crashed = true
					break
				}
			}
			if !crashed {
				remainingCarts = append(remainingCarts, c)
			}
		}
		t.Log(len(carts), len(remainingCarts))
		carts = remainingCarts
		if len(carts) == 1 {
			t.Fatal(carts[0])
		}
		// panic("bye")
	}
	t.Fatal(8868)
}

var input = `                                              /--------------------------------------------------------------------------------\
                                      /-------+--------------------------------------------------------------------------------+-\
   /----------------------------------+-------+-----------------\     /--------\                                               | |
   |                                  |       |/----------------+-----+--\     |                                               | |     /------------\
   |                         /--------+-------++-------------<--+-----+--+-----+-----------------------------\  /--------------+-+-----+-\          |
   |  /----------------------+--------+-------++----------\     |     | /+-----+----\          /-------------+-\|       /------+-+---\ | |          |
   |  |                      |   /----+-------++----------+-----+-----+-++-----+----+----------+-------------+-++-------+------+-+\  | | |          |
   |  |                      |   |/---+-------++----------+-----+\    | ||     | /--+----------+------------\| ||       |      | ||  | | |          |
   |  |                      |   ||   |       ||          |     ||    | ||     | |  |     /----+------------++-++-------+------+-++--+-+\|          |
   |  |              /-------+---++---+-------++----------+-----++----+-++----\| |  |     |  /-+------------++-++-------+------+-++--+-+++---\      |
   |  |              | /-----+---++---+-------++----------+-----++----+-++-\  || |  |     |  | |            || ||       |      | ||  | |||   |      |
   |  |              | | /---+---++---+-------++----------+-----++----+\|| |  || |/-+-----+--+-+------------++-++-------+------+-++--+-+++\  |      |
   |  |              | | |   |  /++---+-------++----------+-----++----++++-+--++-++-+-----+--+-+------------++-++-------+------+-++--+\||||  |      |
   |  |              | | |   |  |||   |       ||    /-----+-----++----++++-+--++-++-+-----+--+-+------------++-++-------+------+-++--++++++--+-----\|
   |  |              | | |   |  |||   |       ||    |/----+-----++--\ |||| |  || || |     |  | |            || |\-------+------+-++--++++/|  |     ||
   \--+-->-----------+-+-+---+--+++---+-------++----++----+-----/|  | ||\+-+<-++-++-/     |  | |            || |        |      | ||  |||| |  |     ||
      |      /-------+-+-+---+\ |||   |       ||    ||    |      |  | || | |  || ||       |/-+-+------------++-+--------+------+-++--++++-+--+-\   ||
      |      |       | | |   || ||| /-+-------++----++----+------+--+-++-+-+--++-++-------++-+-+------------++-+--------+------+\||  |||| |  | |   ||
      |      |       | | |   || ||| | |       ||    ||    |      |  | || | |  || ||       || | |            || |        |      ||||  |||| |  | |   ||
      |   /--+-------+-+-+---++-+++-+-+--\    ||    ||    |      |  | || | |  || ||       || | |            || |        |      ||||  |||| |  | |   ||
      |   |  |       | |/+---++-+++-+-+--+----++----++----+------+--+-++\| |  || ||       || | |            || |      /-+------++++-\|||| |  | |   ||
      |   |  |       | ||| /-++-+++-+-+--+----++----++----+------+-\| |||| |  || ||       || | |            || |      | |      |||| ||||| |  | |   ||
      |   |  |       | ||| | || ||| | |  |    |^    ||    |      | || |||| |  || ||       || | | /----------++-+\     | |      |||| ||||| |  | |   ||
      |   | /+-------+-+++-+-++-+++-+-+--+----++----++----+------+-++-++++-+--++-++-------++-+-+\|          || ||     | |      |||| ||||| |  | |   ||
      |   | ||       | ||| | || ||| | |  |    ||    ||    |      |/++-++++-+--++-++-------++-+-+++----------++-++-----+-+------++++-+++++-+--+\|   ||
      |   |/++-------+-+++-+-++-+++-+-+--+----++----++----+------++++-++++-+--++-++-------++-+-+++----------++-++-----+\|      |||| ||||| |  |||   ||
      |   ||||       | ||| | || ||| | \--+----++----++----+------++++-++++>+--++-++-------++-+-+++----------++-++-----+++------++/| ||||| |  |||   ||
      |   ||||       | ||| | ||/+++-+----+----++----++----+------++++-++++-+--++-++-------++-+-+++----------++-++-----+++--\   || | ||||| |  |||   ||
      |   ||||  /----+-+++-+-++++++-+----+----++----++--\ |      |||| |||| |  || ||       || | |||          || ||     |||  |   || | ||||| |  |||   ||
      |   ||||  |    | ||| | |||||| |    |    ||    ||  | |      |||| |||| |  || ||       || | |||          || ||     ||\--+---++-+-+/||| |  |||   ||
      |   ||||  |    | ||| | |||||| |    | /--++----++--+-+------++++-++++-+--++-++-------++-+-+++----------++-++--\  ||   |   || | | ||| |  |||   ||
      |   ||||  |    | ||| | |||||| |    | |  ||    ||  |/+------++++-++++-+--++-++-------++-+-+++----------++-++--+--++---+---++-+-+-+++-+--+++---++\
      |   ||||  |    | ||| | |||||| |    | |  ||   /++--+++------++++-++++-+--++-++-------++-+-+++----------++-++--+--++---+---++-+-+-+++-+-\|||   |||
      |   |||\--+----+-+++-+-+/|||| |    | |  ||   |\+--+++------++++-++++-+--++-++-------++-+-+++----------++-++--+--++---+---++-+-+-+++-+-++++---/||
      v   |||   |    | ||| | | |||| |    | |  ||   | | /+++------++++-++++-+--++-++-------++-+-+++----------++-++--+--++---+---++-+-+-+++-+-++++---\||
  /---+---+++---+--\ | ||| | | |||| |    | |  ||   | | ||||      |||| |||| |  || ||     /-++-+-+++----------++-++--+-\||   |   || | | ||| | ||||   |||
  |   |   |||   |  | | ||| | | |||| |    | |  \+---+-+-++++------++++-++++-+--++-++-----+-++-+-+++----------++-++--+-+++---+---/| | | ||| | ||||   |||
  |   |   |||   |  | | ||| | | |||| |    | |   |   | |/++++------++++-++++-+--++-++-----+-++-+-+++-----\    || ||  | |||   |    | | | ||| | ||||   |||
  |   |   |||   |  | | ||| | | |||| |  /-+-+---+---+-++++++------++++-++++-+--++-++-----+-++\| |||     |    || ||  | |||   |    | | | |\+-+-++++---+/|
  |   |   |||   |  | | ||| | | |||| |  | | |  /+---+-++++++------++++-++++-+--++-++-----+-++++-+++-----+----++-++--+-+++---+----+-+-+-+-+-+\||||   | |
  |   |   |||   |  | | ||| | | |||| |  |/+-+--++---+-++++++------++++-++++-+--++-++-----+-++++-+++-----+----++\||  | |||   |    | | | | | ||||||   | |
  |   |   |||   |  | | ||| | | |||| |  ||| |  ||   | ||||||      |||| |||| |  || ||     | |||| \++-----+----+++/|  | |||   |    | | | | | ||||||   | |
  |  /+---+++---+--+-+-+++-+-+-++++-+--+++-+--++---+-++++++------++++-++++-+--++-++\    | ||||  ||     |    ||| |  | |||   |    | | | | | ||||||   | |
  |  ||   |||   |  | | ||| | |/++++-+--+++-+--++---+-++++++------++++-++++-+--++-+++----+-++++--++-----+--\ ||| |  | |||   |    | | | | | ||||||   | |
  |  ||   \++---+--+-+-+++-+-++++++-+--++/ |  ||   | ||||||      |||| |||| |  || |||    | ||||  ||     |  | ||| |  | |||   |    | | | | | ||||||   | |
  |  ||    ||   |  | | ||| | |||||| |  ||  |  ||   | ||||||      |||| |||| |  || \++----+-++++--++-----+--+-/|| |  | |||   |    | | | | | ||||||   | |
  |  ||    ||   |  | | ||| | |||||| | /++--+--++---+-++++++------++++-++++-+--++--++----+-++++--++-----+--+--++-+--+-+++--\|    | | | | | ||||||   | |
  |  ||    || /-+--+-+-+++-+-++++++-+-+++--+--++---+-++++++------++++-++++-+--++--++----+-++++--++-----+--+\ || |  | |||  ||    | | | | | ||||||   | |
  | /++----++-+-+--+-+-+++-+-++++++-+-+++--+--++---+-++++++--\   |||| |||| |  ||  ||    | |\++--++-----+--++-++-+--+-+++--++----+-+-+-+-+-+++++/   | |
  | |||    || | |  | | ||| | |||||| | |||  |  ||   | ||||||  |   |||| |||| |  ||  \+----+-+-++--++-----+--++-++-+--+-+++--++----+-+-+-+-+-/||||    | |
  | |||    || | |  | | ||| | |||||| | |||  |  ||   | ||||||  |   |||| |||| |  ||   |    | | ||  ||     |  || || v  | |||  ||    | | | | |  ||||    | |
  | |||    || | |  | | ||| | |||||| | |||  |  ||   | \+++++--+---+++/ |||| |  ||   |    | | ||  |\-----+--++-++-/  | |||  ||    | | | | |  ||||    | |
  \-+++----++-+-+--/ | ||| | |||||| | |||  |  ||   |  |||||  |/--+++--++++-+--++--\|    | | ||  |      |/-++-++----+-+++--++----+-+-+-+-+--++++-\  | |
    |||    || | | /--+-+++-+-++++++-+-+++--+--++---+--+++++-\||  |||  |||| |  ||  ||    | | ||  |      || |v ||    | |||  ||    | | | | |  |||| |  | |
    |||    || | | |  \-+++-+-++++++-+-+++--+--++---+--+++++-+++--+++--++++-+--/|/-++----+-+-++--+------++-++-++----+-+++--++-\  | | | | |  |||| |  | |
    |||    || | | |    ||| | \+++++-+-+++--+--++---+--+++++-+++--+++--++++-+---++-++----+-+-++--+------++-++-/|    | |||  || |  | | | | |  |||| |  | |
    |||    || | | |    |||/+--+++++-+-+++--+--++---+--+++++-+++--+++--++++-+---++-++----+-+-++--+------++-++--+----+-+++--++-+--+-+-+\| v  |||| |  | |
    |||    || | | |    |||||  ||||| | |||  |  ||   |  ||||| |||  |||  |||| |   || ||    | | || /+------++-++--+----+-+++--++-+--+-+-+++-+--++++-+-\| |
    |||    || | | |    |||||  ||||| | |||  |  ||   |  ||||| |||  |||  |||| | /-++-++----+-+-++-++-----\|| ||  | /--+-+++--++-+--+\| ||| |  |||| | || |
  /-+++----++-+-+-+----+++++--+++++-+-+++--+--++---+\ ||||| |||  |||  |||| | | || ||    | | |\-++-----+++-++--+-+--+-+++--++-+--+++-+++-+--++/| | || |
  | |||    || | | |    |||||  ||||| | |||  |  ||   || ||||| |||  |||  |||| | | || || /--+-+-+--++-----+++-++--+-+--+-+++--++-+--+++-+++-+--++-+-+-++\|
/-+-+++----++-+-+-+----+++++--+++++-+-+++--+--++---++-+++++-+++--+++--++++\| | || || |  | | |  ||     ||| ||  | |  | |||  || |  ||| ||| |  || | | ||||
| | |||    || | | |    |\+++--+++++-+-+++--+--++---++-+++++-+++--+++--++/||| | || || |  | | |  ||     ||| ||  | |  | |||  || |  ||| ||| |  || | | ||||
|/+-+++----++\| | |    | |||  ||||| | |||  |  ||   || ||||| |||  |||  ||/+++-+-++-++-+--+-+-+--++-----+++-++--+-+--+-+++-\|| |  ||| ||| |  || | | ||||
||| |||   /++++-+-+----+-+++--+++++-+-+++\ |  ||/--++-+++++-+++--+++--++++++-+-++-++-+--+\| |  ||     ||| ||  | |  | ||| ||| |/-+++-+++-+\ || | | ||||
||| |||   ||||| | |    | |||  ||||| | |||| |  |||  || ||||| |||  |||  |||||| | || || |  ||\-+--++-----+++-++--+-+--+-+++-+++-++-+++-+++-/| || | | ||||
||| |||   ||||| | |    | |||  ||||| | |||| |  |||  || ||||| |||  |||  |||||| | || || |  ||  |  ||     ||| ||  | |  | ||| ||| || ||| |||  | || | | ||||
||| |||   ||||| | |    | |||  ||||| | |||| |  |||  || ||||| |||  |||  \+++++-+-/| || |  ||  |  ||   /-+++-++--+-+--+-+++-+++-++-+++\|||  | || | | ||||
||| |||   ||||| | |    | ||\--+++++-+-++++-+--+++--++-+++++-+++--++/   ||||| |  | || |  ||  |  ||   | ||| ||  | |  | ||| ||| || |||||||  | || | | ||||
||| |||  /+++++-+-+----+-++---+++++-+-++++-+\ |||  || |\+++-+++--++----+++++-+--+-++-+--++--+--++---+-+++-++--+-+--+-+++-+++-++-+++++++--+-++-+-+-+/||
||| |||  |||||| | |    | ||   ||||| | |||| || |||  || | ||| |||  ||    |||||/+--+-++-+--++--+--++--\| ||| ||  | |  | ||| ||| || |||||||  | || | | | ||
||| |||  |||||| | |    | ||   ||||| | |||| ||/+++--++-+-+++-+++--++----+++++++--+\|| \--++--+--++--++-+++-++--+-+--+-+++-+++-++-+++++++--+-++-+-+-+-/|
||| |||  |||||| | |    | || /-+++++-+-++++-++++++--++-+-+++-+++--++----+++++++--++++----++--+--++--++-+++-++--+-+--+\||| ||| || |||||||  | || | | |  |
||| |||  |||||| | |    | || | ||||| | |||| ||||||  || | ||| |||  ||    |||||||  |||| /--++--+--++--++-+++-++\ | |  ||||| ||| || |||||||  | || | | |  |
||| |||  |||||| | |    | || | ||||| | |||| ||||||  || | ||| |||  ||    |||||||  |||| |  ||  |  ||  || ||| ||| | |  ||||| ||| || |||||||  | || | | |  |
||| |||  |||||| | |    | || | ||||| | |||| ||||||  || | ||| |||  ||    |||||||  |||| |  ||  |  ||  || ||| ||| | | /+++++-+++-++-+++++++--+-++-+\| |  |
||| |||  |||||| | |    | || | ||||| | |||| |||||\--++-+-+++-+++--++----+++++++--++++-+--+/  |  ||  || ||| ||| | |/++++++-+++-++\|||||||  | || ||| |  |
||| |||  |||||| | |    | || | ||||| | |||| |||||   || | ||| |||  |\----+++++++--++++-+--+---+--++--++-+++-+++-+-++++++++-+++-++++++++++--+-++-/|| |  |
||| |||  |||||| | |/---+-++-+-+++++-+-++++-+++++---++-+-+++-+++--+----\|||||||  |||| |  |   |  ||  || ||| ||| | |||||||| ||| ||||||||||  | ||  || |  |
||| |||  |||||| | ||   | || | ||||| | |||| |||||   || | ||| |||  |    ||||||||  |||| |  |   |  ||  || ||| ||| | |||||||| ||| ||||||||||  | ||  || |  |
||| |||  |||||| | ||   | \+-+-+++++-+-++++-+++++---++-+-+++-+++--+----+/||||||  ||||/+--+---+--++--++-+++-+++-+-++++++++\||| ||||||||||  |/++--++-+-\|
||| |||  |||||| | ||   |  | | ||||| | |||| |||||   || | ||| |||  |    | ||||||  ||||||  |   |  ||  || ||| ||| | |||||||||||| ||||||||||  ||||  || | ||
||| |||  |||||| | ||   |  | | ||||| | |||| |||||   || | ||| |||  |    | ||||||  ||||||  |   |  ||  || |||/+++-+-++++++++++++-++++++++++--++++\ || | ||
||| |||  |||||| | ||   |  | | ||||| \-++++-+++++---++-+-+++-+++--+----+-++++++--++++++--+---+--++--++-+++++++-+-++++++++++++-+++/||||||  ||||| || | ||
||| |||  |||||| | ||   |  | | ||||| /-++++-+++++-\ || | ||| |||  |    | ||||||  ||||||  |   |  ||  || ||||||| | |||||||||||| ||| ||||||  ||||| || | ||
||| |||  |||||| | ||   |  | | |||\+-+-++++-+++++-+-++-+-+++-+++--+----+-++++++--++++++--+---+--++--++-+++++++-+-++++++++++++-+++-+/||||  ||||| || | ||
||| |||  |||v|| | ||   |  | | ||| | | |||| ||||| | || | ||| |||  |    | ||||||  ||||||  |   |  ||  || ||||||| | |||||||||||| ||| | ||||  ||||| || | ||
||| |||  |||||| | ||   |  \-+-+++-+-+-++++-+++++-+-++-+-+++-+++--+----+-++++++--++++++--+---+--++--++-+++++++-+-++++++++++++-+++-+-++/|  ||||| || | ||
||| |||  |||||| \-++---+----+-+++-+-+-++++-+++++-+-++-+-/|| |||  |    | ||||||  ||||||  |/--+--++--++-+++++++-+-++++++++++++-+++-+-++-+\ ||||| || | ||
||| |||  ||\+++---++---+----+-+++-+-+-++++-+++++-+-++-+--++-+++--+----+-++++++--++++++--++--+--++--++-+++++++-+-+++++++/|||| ||| | || || ||||| || | ||
|||/+++--++-+++---++---+----+-+++-+-+-++++-+++++-+-++\|  || |||  |    |/++++++--++++++--++--+--++--++-+++++++-+-+++++++-++++\||| | || || ||||| || | ||
|||||||  || |||   ||   |    | ||| | | |||| ||||\-+-++++--++-+++--+----+++/||||  ||||||  ||  |  ||  || ||||||| | ||||||| |||||||| | || || ||||| || | ||
|||||||  || |||   ||   |    | ||\-+-+-++++-++++--+-++++--++-+++--+----+++-++++--++++++--++--+--++--++-+++++++-+-+++++++-++++++++-+-++-/| ||||| || | ||
|||||||  || |||/--++---+--\ | ||  \-+-++++-++++--+-++++--++-+++--/    ||| ||||  ||||||  ||  |  ||  || ||||||| | ||||||| |||||||| | ||  | ||||| || | ||
|||||||  || ||||  ||   |  | | ||    | |||| ||||  | ||||  \+-+++-------+++-++++--++++++--++--+--++--++-+++++++-+-+++++++-++++++++-+-++--+-+++++-++-+-+/
|||||||  || ||||  ||   |  | | ||    |/++++-++++--+-++++--\| ||\------<+++-++++--++/|||  ||  |  ||  || ||||||| | ||||||| |||||||| | ||  | ||||| || | |
|||||||  || ||||  ||   |  | |/++----++++++-++++--+-++++--++-++--------+++-++++--++-+++--++--+--++--++-+++++++-+\||||||| |||||||| | ||  | ||||| || | |
|||||||  || ||||  ||   |  | ||||    |||||| |||\--+-++++--++-++--------+++-++++--++-+++--++--+--++--++-+++++++-+++++++++-++++++++-+-++--+-++/|| || | |
|||||||  || ||||  ||   |  | ||||    |||||| |||   | ||||  || ||        ||| ||||  || |||  ||  |  ||  || ||||||| ||||||||| |||||||| | ||  | || || || | |
|||||||  || ||||  ||   |  |/++++----++++++-+++---+-++++--++-++---\    ||| ||||  || |||  |\--+--++--++-+++++++-+++++++++-++++++++-+-++--/ || || || | |
|||||||  || ||||  ||   |  ||||||    ||\+++-+++---+-++++--++-++---+----+++-++++--++-+++--+---+--++--++-+++++++-+++++++++-++/||||| | ||    v| || || | |
||||\++--++-++++--++---+--++++++----++-+++-+++---+-++++--++-+/   |    ||| |||| /++-+++--+---+--++--++-+++++++-+++++++++-++-+++++-+\||    || || || | |
|||| ||  || ||||  ||   |  ||||||    || ||| |||   | ||||  ||/+----+----+++-++++-+++-+++--+---+--++--++-+++++++-+++++++++-++-+++++-++++>---++-++\|| | |
|||| ||  || ||||  ||   |  ||\+++----++-+++-+++---+-++++--++++----+----+++-++++-+++-+++--+---+--++--++-+++++++-++++++/|| || ||||| ||||    || ||||| | |
|||| ||  || ||||  ||  /+--++-+++----++-+++-+++---+-++++--++++--\ |    ||| ||\+-+++-+++--+---+--++--/| ||||||| |||||| || || ||||| ||||    || ||||| | |
|||| ||  || ||\+--++--++--++-+++----++-+++-+++---+-++++--++++--+-+----+++-++-+-+++-+++--+---+--++---+-+++++/| |||||| || || ||||| ||||    || ||||| | |
|||| ||  || || |  ||  ||  || |||   /++-+++-+++---+-++++--++++--+\|    ||| || | ||| |||  |   |  ||   | ||||| | ||||\+-++-++-+++++-++++----++-+++/| | |
|||| ||  || || |  ||  ||  || ||\---+++-+++-+++---+-++++--++++--+++----+++-++-+-+++-+++--+---+--++---+-+++++-+-++++-+-++-++-/|||| ||||    || ||| | | |
|||| ||  || || |  ||  ||  || ||    ||| ||| |||   | ||||/-++++--+++----+++-++-+-+++-+++--+---+-\||   | ||||| | |||| | || ||  |v|| ||||    || ||| | | |
|||| ||  || || |  ||  ||  || ||    ||\-+++-+++---+-+++++-/|||  |||    ||| || | ||| |||  |   | |||   | ||||| | |||| | || ||/-++++-++++\   || ||| | | |
|||| ||  || || |  ||  ||  || ||    ||  |\+-+++---+-+++++--+++--+++----+++-++-+-+++-+++--+---+-+++---+-+++++-+-/||| | || ||| |||| |||||   || ||| | | |
|||| ||  || || |  ||  ||  || ||    ||  | | |||   | |||||  |||  |||    ||| || | ||| ||\--+---+-+++---+-+++++-/  ||| | || ||| |||| |||||  /++-+++-+-+\|
|||| |\--++-++-+--++--++--++-++----++--+-+-+++---+-+++++--/||  |||    ||| || | ||| ||   |   | |||   | |||||    ||| | || ||| |||| |||||  ||| ||| | |||
|||| |   || ||/+--++--++--++-++----++--+-+-+++---+-+++++---++--+++---\||| || \-+++-++---+---+-+++---+-/||||    ||| | || ||| |||| |||||  ||| ||| | |||
|||| |   || ||||  ||  ||  || ||    |\--+-+-+++---/ |||||   \+--+++---++++-++---+++-++---+---+-+++---+--++++----+++-+-++-+++-++++-+++++--+++-++/ | |||
||\+-+---++-++++--++--++--++-++----+---+-+-+++-----+/|||    |  |||   |||| ||   \++-++---+---+-+++---+--++++----+++-+-++-+++-++++-+/|||  ||| ||  | |||
|| | |   || |||\--++--++--/| ||    \---+-+-+++-----+-+++----+--+/|   |||| ||    || ||   |   | |||   |  ||||    ||| | || ||| |||| | |||  ||| ||  | |||
|| |/+---++-+++---++--++---+-++--------+-+-+++-----+-+++----+--+-+---++++-++---\|| ||   |   | |||   |  ||||    ||| | || ||| |||| | |||  ||| ||  | |||
|| |||   || |||   ||  |\---+-++--------+-+-+++-----+-+++----+--+-+---++++-+/   ||| ||   |   | |||   |  ||||    ||| | || ||| |||| | |||  ||| ||  | |||
|| |||   || |||   ||/-+----+-++--------+-+-+++-----+-+++----+--+-+---++++-+----+++-++---+---+\|||   |  ||||    ||| | || ||| |||| | |||  ||| ||  | |||
|| \++---++-+++---+++-+----+-++--------+-+-+++-----+-/||    |  | |   |||| |    ||| ||   |   |||||   |  ||||   /+++-+-++-+++-++++-+-+++--+++-++-\| |||
\+--++---++-+++---+++-+----+-++--------+-+-+++-----+--++----+--+-+---++++-/    ||| ||   |   |||||   |  ||||   |||\-+-++-+++-+++/ | |||  ||| || || |||
 |  ||   |\-+++---+++-+----+-++--------+-/ |||     |  ||    |  | |   ||||      ||| ||   |   |||||   |  ||||   |||  | |\-+++-+++--+-+/|  ||| || || |||
 |  ||   |  |||   ||| |    | ||        |   |||     |  ||    |  | |   ||||      ||| ||   \---+++++---+--++++---+++--+-/  ||| |||  | | |  ||| || || |||
 |  ||   |  |||   ||| \----+-++--------+---+++-----+--++----+--/ |   ||||      ||| ||       |||||   |  ||||   |||  |    ||| |||  | | |  ||| || || |||
 |  ||   |  |||   |||      | ||        |   ||\-----+--++----+----+---++++------++/ ||       |||||   |  ||||   |||  |    ||| |||  | | |  ||| || || |||
 |  ||   |  |||   |||      | ||        |   \+------+--++----+----+---++++------++--++-------+++++---+--++++---+++--/    ||| |||  | | |  ||| || || |||
 |  ||   |  |||   |\+------+-++--------+----+------+--++----+----+---+/||      ||  ||       |||||   |  ||||   |||       ||| |||  | | |  ||| || || |||
 |  ||   |  |||   | |      | ||        |    |      |  \+----+----+---+-++----->++--++-------+++++---+--/|||   ||\-------+++-+++--/ | |  ||| || || |||
 |  ||   |  |||   \-+------+-++--------+----+--<---+---+----/    |   | ||      ||  ||       |||||   |   |||   ||        ||| |||    | |  ||| || || |||
 |  ||   |  \++-----+------+-++--------+----+------+---+---------+---+-++------++--++-------++++/   |   \++---++--------+++-+++----+-+--+++-++-+/ |||
 |/-++---+---++-----+------+-++--------+----+------+---+---------+---+-++-----\||  ||       ||||    |    ||   ||        ||\-+++----+-/  ||| || |  |||
 || ||   |   ||     |      | ||        |    |      |   \---------+---+-++-----+++--++-------++/|    |    ||   ||        ||  |||    |    ||| || |  |||
 || ||   |   ||     |      | ||        |    |      \-------------+---+-++-----+++--++-------++-+----+----++---++--------++--+++----+----+++-/| |  |||
 || ||   |   ||     |      | ||        \----+--------------------+---+-++-----+++--++-------/| |    |    ||   ||        ||  |||    |    |||  | |  |||
 || ||   |   ||     |      | ||             |                    |   | ||     |||  |\--------+-+----+----++---++--------/|  |||    |    |||  | |  |||
 || ||   |   ||     \------+-++-------------+--------------------+---+-++-----+++--+---------/ |    |    ||   ||         |  |||    |    |||  | |  |||
 || ||   |   ||            | ||             |   /----------------+---+-++---\ |||  |           |    |    ||   ||         |  |||    |    |||  | |  |||
 || ||   |   ||            \-++-------------+---+----------------/   | \+---+-+++--+-----------+----+----++---++---------+--/||    |    |||  | |  |||
 \+-++---+---/\--------------++-------------+---+--------------------/  |   | |||  |           |    |    ||   ||         |   ||    |    ||\--+-+--++/
  | \+---+-------------------++-------------+---+-----------------------+---+-+/|  |           |    |    ||   ||         |   ||    |    \+---+-+--+/
  |  |   |                   ||             |   |                       \---+-+-+--+-----------+----+----++---++---------/   ||    |     |   | |  |
  |  \---+-------------------++-------------+---+---------------------------+-+-+--/           |    |    \+---++-------------++----+-----+---/ |  |
  |      |                   \+-------------+---+---------------------------+-+-+--------------+----+-----+---+/             |\----+-----/     |  |
  \------+--------------------+-------------+---+---------------------------+-/ |              |    \-----+---+--------------+-----/           |  |
         |                    |             |   |                           |   |              \----------+---+--------------+-----------------+--/
         |                    \-------------+---+-<-------------------------+---+-------------------------/   \--------------+-----------------/
         |                                  |   |                           |   |                                            |
         \----------------------------------/   \---------------------------/   \--------------------------------------------/

`
